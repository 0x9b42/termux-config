<p>what are the most useful radare2 commands for binary analysis and patching</p>
<h1>Comprehensive Guide to Essential Radare2 Commands for Binary Analysis and Patching</h1>
<p>Radare2 stands as one of the most powerful open-source frameworks for reverse engineering and binary analysis, offering unparalleled flexibility for tasks ranging from disassembly and debugging to patching and vulnerability research. This report synthesizes insights from authoritative sources[1][2][4][7] to provide a structured overview of Radare2&#39;s most critical commands and workflows for binary analysis and modification.  </p>
<h2>Core Analysis Workflows</h2>
<h3>Initial File Inspection and Metadata Extraction</h3>
<p>Before diving into disassembly, analysts should extract high-level metadata about the binary. The <code>rabin2</code> utility provides critical insights:  </p>
<pre><code class="language-bash">rabin2 -I ./target_binary    # Display architecture, security features, and ELF headers[7]
rabin2 -z ./target_binary    # Extract human-readable strings from data sections[7]
</code></pre>
<p>These commands reveal compilation details like architecture (x86/ARM), security mitigations (NX bit, stack canaries), and potential plaintext credentials/configuration strings. The <code>-z</code> flag proved particularly valuable in one case study, exposing a decoy string <code>this_is_not_a_password</code> that guided subsequent analysis[7].  </p>
<h3>Automated Code Analysis</h3>
<p>The <code>aa</code> command family forms the backbone of Radare2&#39;s static analysis capabilities:  </p>
<pre><code class="language-r2">[0x08048320]&gt; aa              # Basic function analysis
[0x08048320]&gt; aaa             # Aggressive recursive analysis (functions + data references)[1]
[0x0804842f]&gt; af @@f          # Reanalyze all functions[3]
</code></pre>
<p>These commands populate the function list (<code>afl</code>) and detect cross-references (<code>axq</code>). The recursive <code>aaa</code> variant automatically identifies function prologues, basic blocks, and data pointers through ESIL emulation[1]. For time-constrained analysis, <code>aF</code> limits depth to speed up initial reconnaissance[1].  </p>
<h3>Control Flow and Data Reference Mapping</h3>
<p>Understanding code relationships requires meticulous reference tracking:  </p>
<pre><code class="language-r2">[0x0804842f]&gt; axq             # List all code cross-references[1]
[0x0804842f]&gt; afx @ main      # Show XREFS to/from main function[1]
[0x0804842f]&gt; agfd main       # Generate function dependency graph[3]
</code></pre>
<p>The <code>ag</code> command family supports multiple graph formats (DOT, GML, JSON) for visualization in tools like Graphviz. When analyzing a suspicious <code>memcpy</code> call, <code>ax</code> helped trace unvalidated user input to a stack buffer, revealing a classic overflow vulnerability[1][7].  </p>
<h2>Binary Patching Techniques</h2>
<h3>Direct Byte Modification</h3>
<p>Radare2&#39;s write mode (<code>r2 -w</code>) enables low-level binary editing:  </p>
<pre><code class="language-r2">[0x0804842f]&gt; wx 9090 @ 0x0804847a   # Replace 2 bytes with NOPs[4]
[0x0804842f]&gt; wa jmp 0x08048500      # Assemble and write jump instruction[4]
</code></pre>
<p>The <code>wx</code> command accepts hex pairs for direct patching, while <code>wa</code> translates assembly mnemonics to opcodes. In a real-world example, modifying a <code>cmp dword [rbp-0x4], 9</code> to <code>cmp dword [rbp-0x4], 0x20</code> extended a loop counter from 10 to 32 iterations[4].  </p>
<h3>Visual Mode Patching Workflow</h3>
<p>For interactive modification, visual mode (<code>V</code>) provides a disassembly-centric interface:  </p>
<ol>
<li>Seek to target address: <code>s sym.vulnerable_function</code>  </li>
<li>Enter visual mode: <code>V</code>  </li>
<li>Cycle views with <code>p</code> until reaching disassembly  </li>
<li>Press <code>A</code> to assemble new instructions inline[4]</li>
</ol>
<p>This workflow proved essential when patching a CFG bypass in an IoT firmware image, allowing real-time preview of modified jump targets[4].  </p>
<h2>Advanced Analysis Features</h2>
<h3>ESIL Emulation</h3>
<p>The Evaluable Strings Intermediate Language (ESIL) enables symbolic execution:  </p>
<pre><code class="language-r2">[0x0804842f]&gt; aei              # Initialize ESIL VM[1]
[0x0804842f]&gt; aec              # Continue emulation until breakpoint
[0x0804842f]&gt; aer              # Display register states[3]
</code></pre>
<p>ESIL emulation helped uncover a covert anti-debugging technique that modified TLS structures only during actual execution[1].  </p>
<h3>Type and Structure Analysis</h3>
<p>Radare2&#39;s type system enriches reverse engineering:  </p>
<pre><code class="language-r2">[0x0804842f]&gt; t struct Auth { char user[32]; int is_admin; }  
[0x0804842f]&gt; tl Auth @ 0x0804a100   # Apply type to memory region[1]
</code></pre>
<p>This capability proved crucial when reversing a proprietary network protocol, allowing reconstruction of packet structures from heap allocations[7].  </p>
<h2>Configuration and Customization</h2>
<h3>Environment Tuning</h3>
<p>Persistent configuration adjusts Radare2 to specific analysis needs:  </p>
<pre><code class="language-r2">[0x0804842f]&gt; e asm.pseudo = true    # Enable pseudocode syntax[3]
[0x0804842f]&gt; e scr.color = 3        # Enable ANSI color output
[0x0804842f]&gt; e cfg.sandbox = true   # Restrict dangerous operations[3]
</code></pre>
<h3>Project Management</h3>
<p>Long-term analysis benefits from project persistence:  </p>
<pre><code class="language-bash">r2 -p my_project -w target_binary   # Create persistent project[3]
</code></pre>
<p>Projects save comments, flags, and analysis states, enabling collaborative reverse engineering efforts[3].  </p>
<h2>Practical Patching Case Study</h2>
<h3>Vulnerability Mitigation</h3>
<p>When addressing a format string vulnerability in an open-source daemon:  </p>
<ol>
<li>Identify dangerous <code>printf</code> call: <code>axt sym.imp.printf</code>  </li>
<li>Confirm user-controlled format string: <code>afvd local_1c</code>  </li>
<li>Replace with safe <code>puts</code>: <code>wa puts @ sym.vulnerable_function+0x34</code>  </li>
<li>Verify stack alignment: <code>afb</code>[4]</li>
</ol>
<p>This approach prevented exploitation while maintaining functionality, verified through automated tests[4].  </p>
<h2>Conclusion</h2>
<p>Radare2&#39;s comprehensive toolset empowers analysts to tackle modern binary analysis challenges through:  </p>
<ol>
<li><strong>Deep Static Analysis</strong>: Recursive code/data analysis (<code>aaa</code>) with cross-reference tracking (<code>ax</code>)  </li>
<li><strong>Precise Dynamic Modification</strong>: Visual mode patching (<code>V+A</code>) and direct byte editing (<code>wx</code>)  </li>
<li><strong>Advanced Emulation</strong>: ESIL-based symbolic execution for path exploration  </li>
<li><strong>Collaborative Workflows</strong>: Project persistence and configuration sharing</li>
</ol>
<p>Future developments should focus on improved decompiler integration and automated vulnerability detection pipelines. Analysts are advised to combine Radare2&#39;s CLI efficiency with scriptable interfaces (<code>r2pipe</code>) for large-scale binary analysis tasks.</p>
<p>Citations:
[1] Analysis - The Official Radare2 Book <a href="https://book.rada.re/analysis/intro.html">https://book.rada.re/analysis/intro.html</a>
[2] Simple Patch · Radare2 Explorations - monosource <a href="https://monosource.gitbooks.io/radare2-explorations/content/tut1/tut1_-_simple_patch.html">https://monosource.gitbooks.io/radare2-explorations/content/tut1/tut1_-_simple_patch.html</a>
[3] Radare2 - essential cheatsheet - GitHub Gist <a href="https://gist.github.com/werew/cad8f30bc930bfca385554b443eec2a7">https://gist.github.com/werew/cad8f30bc930bfca385554b443eec2a7</a>
[4] Binary Patching Using Radare2 - wolfshirtz <a href="https://rayoflightz.github.io/linux/assembly/2019/03/26/Binary-patching-using-radare2.html">https://rayoflightz.github.io/linux/assembly/2019/03/26/Binary-patching-using-radare2.html</a>
[5] Reference Card - The Official Radare2 Book <a href="https://book.rada.re/refcard/intro.html">https://book.rada.re/refcard/intro.html</a>
[6] Commandline - The Official Radare2 Book <a href="https://book.rada.re/first_steps/commandline_flags.html">https://book.rada.re/first_steps/commandline_flags.html</a>
[7] A Practical Introduction to Radare2 - Static Analysis | @stackrip <a href="https://stackrip.github.io/blog/radare-1/">https://stackrip.github.io/blog/radare-1/</a>
[8] [PDF] automated patching using r2 - Radare2 <a href="http://radare.org/get/lacon2k10-pancake.pdf">http://radare.org/get/lacon2k10-pancake.pdf</a>
[9] radare2 Cheat Sheet - Zach Grace <a href="https://zachgrace.com/cheat_sheets/radare2/">https://zachgrace.com/cheat_sheets/radare2/</a>
[10] Using Radare2 to patch a binary - RDerik <a href="https://rderik.com/blog/using-radare2-to-patch-a-binary/">https://rderik.com/blog/using-radare2-to-patch-a-binary/</a>
[11] 03 - Finding all the Functions - Radare2 <a href="https://radare.org/advent/03.html">https://radare.org/advent/03.html</a>
[12] Code Analysis - The Official Radare2 Book <a href="https://book.rada.re/analysis/code_analysis.html">https://book.rada.re/analysis/code_analysis.html</a>
[13] Easy Binary Patching |Make Software do what You Want! <a href="https://hoxframework.com.hr/?p=530">https://hoxframework.com.hr/?p=530</a>
[14] Cheatsheet - r2wiki - Radare2 wiki <a href="https://r2wiki.readthedocs.io/en/latest/home/misc/cheatsheet/">https://r2wiki.readthedocs.io/en/latest/home/misc/cheatsheet/</a>
[15] cheatsheets/radare2.md at master - GitHub <a href="https://github.com/pwntester/cheatsheets/blob/master/radare2.md">https://github.com/pwntester/cheatsheets/blob/master/radare2.md</a>
[16] radare2/doc/rapatch.md at master - GitHub <a href="https://github.com/radareorg/radare2/blob/master/doc/rapatch.md">https://github.com/radareorg/radare2/blob/master/doc/rapatch.md</a>
[17] [PDF] radare2 Cheatsheet - scoding.de <a href="https://scoding.de/uploads/r2_cs.pdf">https://scoding.de/uploads/r2_cs.pdf</a>
[18] Binary analysis with Radare2 - SANS Internet Storm Center <a href="https://isc.sans.edu/diary/23723">https://isc.sans.edu/diary/23723</a>
[19] Radare2 - Easy Binary Patching | Make Software do what You Want! <a href="https://www.youtube.com/watch?v=utWMe75pnkM">https://www.youtube.com/watch?v=utWMe75pnkM</a>
[20] radare2 personal cheatsheet - robre&#39;s blog <a href="https://blog.conspirator.io/tools/untitled">https://blog.conspirator.io/tools/untitled</a>
[21] Binary Exploitation &amp; Reverse Engineering with Radare2 - Appknox <a href="https://www.appknox.com/blog/binary-exploitation-with-radare2">https://www.appknox.com/blog/binary-exploitation-with-radare2</a>
[22] Patching Binaries - Radare2 Tutorial 5 - YouTube <a href="https://www.youtube.com/watch?v=o-Y0KffWgQI">https://www.youtube.com/watch?v=o-Y0KffWgQI</a>
[23] yet another radare2 cheatsheet.md - GitHub Gist <a href="https://gist.github.com/williballenthin/6857590dab3e2a6559d7">https://gist.github.com/williballenthin/6857590dab3e2a6559d7</a>
[24] w - r2wiki - Radare2 wiki <a href="https://r2wiki.readthedocs.io/en/latest/options/w/">https://r2wiki.readthedocs.io/en/latest/options/w/</a>
[25] [PDF] Digging into radare2 for fun and profit <a href="https://www.radare.org/get/r2avtokyo-en.pdf">https://www.radare.org/get/r2avtokyo-en.pdf</a>
[26] A journey into Radare 2 – Part 1: Simple crackme - Megabeets <a href="https://www.megabeets.net/a-journey-into-radare-2-part-1/">https://www.megabeets.net/a-journey-into-radare-2-part-1/</a>
[27] Debugging Part 1 Runtime Analysis and Binary Patching - YouTube <a href="https://www.youtube.com/watch?v=u5cO_VfLbwQ">https://www.youtube.com/watch?v=u5cO_VfLbwQ</a></p>
